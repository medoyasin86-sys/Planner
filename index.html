<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>MYH Luxury Planner 2026 Generator</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  
  <script src="https://cdn.jsdelivr.net/npm/pdfmake@0.2.10/build/pdfmake.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/pdfmake@0.2.10/build/vfs_fonts.js"></script>

  <style>
    :root { 
      --royal-blue: #192a56; 
      --gold: #b8860b; 
      --silk: #f5f5f5; 
      --text: #2f3640;
    }
    body { 
      margin: 0; background: #f0f2f5; color: var(--text); 
      font-family: system-ui, -apple-system, sans-serif; 
    }
    .container { max-width: 900px; margin: 40px auto; padding: 20px; }
    header { 
      background: linear-gradient(135deg, var(--royal-blue), #273c75); 
      color: #fff; padding: 40px; border-radius: 20px; 
      box-shadow: 0 15px 35px rgba(0,0,0,0.2);
      border-bottom: 5px solid var(--gold);
      text-align: center;
    }
    .card { 
      background: #fff; border-radius: 15px; padding: 25px; 
      margin-top: -30px; box-shadow: 0 10px 25px rgba(0,0,0,0.05);
    }
    .btn { 
      background: var(--gold); color: white; border: none; 
      padding: 15px 30px; border-radius: 10px; cursor: pointer; 
      font-weight: bold; font-size: 16px; transition: 0.3s;
    }
    .btn:hover { transform: translateY(-3px); box-shadow: 0 5px 15px rgba(184, 134, 11, 0.4); }
    .status-badge { 
      display: inline-block; padding: 5px 15px; border-radius: 20px; 
      font-size: 12px; background: #e1f5fe; color: #01579b; margin-bottom: 15px;
    }
    textarea { 
      width: 100%; height: 150px; border: 1px solid #ddd; 
      border-radius: 10px; padding: 10px; font-family: monospace; 
    }
    input[type="file"] { margin: 15px 0; }
  </style>
</head>
<body>

<div class="container">
  <header>
    <h1>MYH Luxury Planner 2026</h1>
    <p>توليد البلانر التفاعلي لـ iPad 10.2 (نسخة السيد محمد ياسين)</p>
  </header>

  <div class="card">
    <div class="status-badge">نظام الروابط الداخلية: مفعل ✅</div>
    
    <h3>1. إعداد الخط العربي (خطوة إجبارية)</h3>
    <p style="font-size: 13px; color: #666;">يرجى اختيار ملف خط TTF من جهازك لضمان ظهور اللغة العربية بشكل سليم.</p>
    <input type="file" id="fontFile" accept=".ttf" />
    <button class="btn" id="btnLoadFont" style="background: var(--royal-blue);">تحميل الخط</button>
    <span id="fontStatus"></span>

    <hr style="margin: 30px 0; opacity: 0.2;">

    <h3>2. تخصيص المناسبات (سلطنة عمان)</h3>
    <textarea id="evJson">{
  "2026-01-11": { "name": "يوم تولي السلطان", "type": "national" },
  "2026-03-20": { "name": "عيد الفطر المبارك", "type": "religious" },
  "2026-05-27": { "name": "يوم عرفة", "type": "religious" }
}</textarea>

    <div style="margin-top: 30px; display: flex; gap: 10px;">
      <button id="btnDownload" class="btn" disabled>تحميل البلانر التفاعلي PDF</button>
      <button id="btnOpen" class="btn" style="background: #2f3640;" disabled>معاينة سريعة</button>
    </div>
  </div>
</div>

<script>
    const COLORS = { royal: "#192a56", gold: "#b8860b", silk: "#f9f9f9", lines: "#dcdde1" };
    let customFontLoaded = false;

    // معالجة الخط
    document.getElementById('btnLoadFont').addEventListener('click', async () => {
        const file = document.getElementById('fontFile').files[0];
        if (!file) return alert("اختر ملف الخط أولاً");
        const reader = new FileReader();
        reader.onload = function(e) {
            const base64String = e.target.result.split(',')[1];
            pdfMake.vfs = { 'CustomFont.ttf': base64String };
            pdfMake.fonts = { MyFont: { normal: 'CustomFont.ttf', bold: 'CustomFont.ttf' } };
            customFontLoaded = true;
            document.getElementById('fontStatus').innerText = "✅ تم تحميل الخط بنجاح";
            document.getElementById('btnDownload').disabled = false;
            document.getElementById('btnOpen').disabled = false;
        };
        reader.readAsDataURL(file);
    });

    // بناء محتوى الصفحة اليومية مع الهوية البصرية
    function createDailyPage(dateStr, evMap) {
        return {
            padding: [20, 20, 20, 20],
            id: `day-${dateStr}`,
            stack: [
                // Header
                {
                    columns: [
                        { text: "Mr. Mo. Yasin", style: 'signature', color: COLORS.gold },
                        { text: dateStr, alignment: 'left', style: 'dateHeader' }
                    ]
                },
                { canvas: [{ type: 'line', x1: 0, y1: 5, x2: 500, y2: 5, lineWidth: 1, lineColor: COLORS.gold }] },
                
                // Main Content Area
                {
                    margin: [0, 20, 0, 0],
                    columns: [
                        // Left Column: Schedule
                        {
                            width: '40%',
                            stack: [
                                { text: "جدول الحصص اليومي", style: 'sectionTitle' },
                                {
                                    table: {
                                        widths: ['*', '*'],
                                        body: [
                                            [{text: '07:35 - 08:15', fontSize: 10}, {text: 'الحصة 1', alignment: 'center'}],
                                            [{text: '08:20 - 09:00', fontSize: 10}, {text: 'الحصة 2', alignment: 'center'}],
                                            [{text: '09:05 - 09:45', fontSize: 10}, {text: 'الحصة 3', alignment: 'center'}],
                                            [{text: '09:50 - 10:30', fontSize: 10}, {text: 'الحصة 4', alignment: 'center'}],
                                            [{text: 'الفسحة', colSpan: 2, alignment: 'center', fillColor: COLORS.silk}, ''],
                                            [{text: '10:55 - 11:35', fontSize: 10}, {text: 'الحصة 5', alignment: 'center'}],
                                            [{text: '11:40 - 12:20', fontSize: 10}, {text: 'الحصة 6', alignment: 'center'}],
                                            [{text: '12:25 - 01:05', fontSize: 10}, {text: 'الحصة 7', alignment: 'center'}],
                                            [{text: '01:10 - 01:50', fontSize: 10}, {text: 'الحصة 8', alignment: 'center'}]
                                        ]
                                    },
                                    layout: 'lightHorizontalLines'
                                }
                            ]
                        },
                        // Right Column: Cards
                        {
                            width: '60%',
                            margin: [20, 0, 0, 0],
                            stack: [
                                { text: "بطاقات العمل الـ 5", style: 'sectionTitle' },
                                { canvas: [{ type: 'rect', x: 0, y: 0, w: 300, h: 40, r: 5, lineColor: COLORS.lines }] },
                                { text: " ", margin: [0, 5] },
                                { canvas: [{ type: 'rect', x: 0, y: 0, w: 300, h: 40, r: 5, lineColor: COLORS.lines }] },
                                { text: " ", margin: [0, 5] },
                                { canvas: [{ type: 'rect', x: 0, y: 0, w: 300, h: 40, r: 5, lineColor: COLORS.lines }] },
                                { text: " ", margin: [0, 5] },
                                { canvas: [{ type: 'rect', x: 0, y: 0, w: 300, h: 40, r: 5, lineColor: COLORS.lines }] },
                                { text: " ", margin: [0, 5] },
                                { canvas: [{ type: 'rect', x: 0, y: 0, w: 300, h: 40, r: 5, lineColor: COLORS.lines }] },
                                { text: "الحسابات والمهام", style: 'sectionTitle', margin: [0, 20, 0, 10] },
                                {
                                    table: {
                                        widths: ['*', '30%'],
                                        body: [
                                            [{text: 'البند', fillColor: COLORS.royal, color: 'white'}, {text: 'المبلغ', fillColor: COLORS.royal, color: 'white'}],
                                            ['', ''], ['', '']
                                        ]
                                    }
                                }
                            ]
                        }
                    ]
                }
            ],
            pageBreak: 'after'
        };
    }

    async function generatePDF(open) {
        let evMap = JSON.parse(document.getElementById('evJson').value);
        
        let docDefinition = {
            pageSize: { width: 1620 / 2.83, height: 2160 / 2.83 }, // iPad 10.2 scaling
            defaultStyle: { font: 'MyFont', alignment: 'right' },
            styles: {
                signature: { fontSize: 18, italics: true },
                dateHeader: { fontSize: 14, bold: true, color: COLORS.royal },
                sectionTitle: { fontSize: 12, bold: true, color: COLORS.royal, margin: [0, 10, 0, 5] }
            },
            content: [
                // Cover Page
                {
                    stack: [
                        { text: "MY CUSTOM PLANNER", fontSize: 35, color: COLORS.gold, bold: true, margin: [0, 150, 0, 10] },
                        { text: "2026", fontSize: 50, color: 'white', bold: true },
                        { text: "MR. MO. YASIN", fontSize: 20, color: COLORS.gold, margin: [0, 50, 0, 0] }
                    ],
                    alignment: 'center',
                    fillColor: COLORS.royal,
                    pageBreak: 'after'
                },
                // Index with Hyperlinks
                {
                    text: "الفهرس التفاعلي", style: 'dateHeader', alignment: 'center', margin: [0, 20]
                },
                {
                    columns: [
                        { text: "شهر يناير", linkToDestination: "day-2026-01-01", color: 'blue', decoration: 'underline' },
                        { text: "شهر فبراير", linkToDestination: "day-2026-02-01", color: 'blue', decoration: 'underline' }
                    ],
                    margin: [0, 20]
                }
            ]
        };

        // إضافة أيام عينة (يمكنك عمل حلقة تكرارية لـ 180 يوم)
        docDefinition.content.push(createDailyPage("2026-01-01", evMap));
        docDefinition.content.push(createDailyPage("2026-02-01", evMap));

        if (open) pdfMake.createPdf(docDefinition).open();
        else pdfMake.createPdf(docDefinition).download('MYH_Luxury_Planner_2026.pdf');
    }

    document.getElementById('btnDownload').onclick = () => generatePDF(false);
    document.getElementById('btnOpen').onclick = () => generatePDF(true);
</script>

</body>
</html>
