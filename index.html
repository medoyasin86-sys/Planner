<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
  <title>بلانر أ/ محمد ياسين حلمي - احترافي وشخصي</title>

  <!-- خطوط -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&family=Great+Vibes&family=Marhey:wght@600&display=swap" rel="stylesheet">
  <!-- أيقونات -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <style>
    :root{
      --primary-brown:#7A5230;
      --light-brown:#d8c3a5;
      --dark-blue-gray:#4a6a7c;
      --light-gray:#f2f2f2;
      --medium-gray:#e0e6ed;
      --dark-gray-text:#333;
      --light-text:#888;
      --signature-font:'Great Vibes',cursive;
      --body-font:'Cairo',sans-serif;
      --title-font:'Marhey',sans-serif;
      --paper:#fff;
      --ruled-line:#e9e9e9;
      --ring-metal-1:#a8a9ad;
      --ring-metal-2:#6f6f73;
    }

    html,body{
      margin:0;
      padding:0;
      height:100%;
      background:var(--light-gray);
      color:var(--dark-gray-text);
      font-family:var(--body-font);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      touch-action:manipulation;
    }

    /* الحاوية العامة للصفحتين */
    .planner-container{
      display:flex;
      gap:0; /* لأن السبايرال بينهما */
      max-width:1800px;
      margin:0 auto;
      padding:16px;
      align-items:stretch;
      justify-content:center;
    }

    .planner-page{
      flex:1;
      background:var(--paper);
      border-radius:22px;
      box-shadow:0 8px 30px rgba(0,0,0,.12);
      padding:28px;
      display:flex;
      flex-direction:column;
      min-height:900px;
      position:relative;
      overflow:hidden;
    }

    /* رأس الصفحة */
    .header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:20px;
      padding-bottom:14px;
      border-bottom:1px solid var(--light-gray);
    }
    .header .logo{
      font-family:var(--signature-font);
      font-size:3.2em;
      color:var(--primary-brown);
      line-height:0.7;
      margin-left:16px;
      user-select:none;
    }
    .header .title{ flex:1; text-align:right; }
    .header h1{
      font-family:var(--title-font);
      font-weight:600;
      margin:0;
      font-size:1.55em;
      color:var(--dark-gray-text);
    }
    .header p{
      margin:6px 0 0;
      font-size:.9em;
      color:var(--light-text);
    }

    /* التبويبات */
    .tabs-section{
      display:flex;
      flex-direction:column;
      gap:10px;
      margin-bottom:18px;
    }
    .tab-button{
      display:flex;
      align-items:center;
      gap:10px;
      background:var(--medium-gray);
      padding:12px 16px;
      border-radius:10px;
      color:var(--dark-gray-text);
      border:none;
      cursor:pointer;
      text-align:right;
      transition:transform .15s ease, background-color .2s ease, color .2s ease;
      box-shadow:0 2px 6px rgba(0,0,0,.06);
      width:100%;
    }
    .tab-button i{ color:var(--primary-brown); font-size:1.2em; }
    .tab-button:hover{ transform:translateY(-1px); }
    .tab-button.active, .tab-button:focus{
      background:var(--primary-brown);
      color:#fff;
      outline:none;
    }
    .tab-button.active i{ color:#fff; }
    .tab-button.disabled{
      opacity:.55;
      cursor:not-allowed;
      filter:grayscale(.3);
      pointer-events:none;
      position:relative;
    }

    /* محتوى افتراضي داخل الصفحات (يمكن تركه مختصراً لأننا نفتح صفحات كاملة لاحقاً) */
    .placeholder-note{
      padding:14px;
      background:#fafafa;
      border:1px dashed var(--medium-gray);
      border-radius:10px;
      color:#666;
      font-size:.95em;
    }

    /* السبايرال بين الصفحتين */
    .spiral-wire{
      width:56px;
      min-width:56px;
      margin:0 14px;
      position:relative;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .spiral-wire .strip{
      width:100%;
      height:100%;
      border-radius:16px;
      background:linear-gradient(90deg,#d7d7d9,#f3f3f5 35%,#cfcfd3 70%,#e7e7ea);
      box-shadow:inset 0 0 10px rgba(0,0,0,.12);
      position:relative;
      overflow:hidden;
    }
    /* حلقات معدنية باستخدام SVG مكرر */
    .spiral-wire svg{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none;
    }

    /* صفحات كاملة عند الضغط على التبويبات */
    .page-overlay{
      position:fixed;
      inset:0;
      background:#f7f7f8;
      z-index:99;
      display:none;
      overflow:auto;
      -webkit-overflow-scrolling:touch;
    }
    .page-overlay.active{ display:block; }
    .page{
      max-width:1200px;
      margin:0 auto;
      padding:20px 16px 80px;
    }
    .page .page-card{
      background:var(--paper);
      border-radius:22px;
      box-shadow:0 8px 26px rgba(0,0,0,.10);
      padding:22px;
    }
    .page-header{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:12px;
      margin-bottom:14px;
    }
    .back-btn{
      display:inline-flex;
      align-items:center;
      gap:8px;
      background:var(--primary-brown);
      color:#fff;
      border:none;
      border-radius:10px;
      padding:10px 14px;
      cursor:pointer;
      box-shadow:0 3px 8px rgba(0,0,0,.15);
    }
    .page-title{
      font-family:var(--title-font);
      margin:0;
      font-size:1.2em;
    }

    /* مسطرة عامة */
    .ruled{
      background-image:
        linear-gradient(to bottom, transparent calc(100% - 1px), var(--ruled-line) calc(100% - 1px)),
        linear-gradient(to right, rgba(0,0,0,0.02), rgba(0,0,0,0.02));
      background-size: 100% 34px, 100% 100%;
      background-repeat:repeat;
      border:1px solid #eee;
      border-radius:10px;
    }

    /* قائمة checkbox مسطرة */
    .checkbox-ruled{
      display:flex;
      flex-direction:column;
      padding:8px 10px;
      max-height:70vh;
      overflow:auto;
    }
    .checkbox-ruled .item{
      display:flex;
      align-items:center;
      gap:10px;
      height:34px; /* نفس ارتفاع السطر */
      border-bottom:1px solid var(--ruled-line);
    }
    .checkbox-ruled .item:last-child{ border-bottom:none; }
    .checkbox-ruled input[type="checkbox"]{
      transform:scale(1.2);
      accent-color:var(--primary-brown);
      margin-left:6px;
    }
    .checkbox-ruled .line{
      flex:1;
      height:100%;
    }
    .toolbar{
      display:flex;
      gap:8px;
      align-items:center;
      margin-bottom:10px;
      flex-wrap:wrap;
    }
    .toolbar .btn, .toolbar .small-input{
      background:#fff;
      border:1px solid #ddd;
      border-radius:8px;
      padding:8px 10px;
      cursor:pointer;
      font-size:.95em;
    }
    .toolbar .btn i{ margin-left:6px; color:var(--primary-brown); }
    .toolbar .btn:hover{ background:#fafafa; }

    /* جدول المصروفات */
    .expenses-table{
      width:100%;
      border-collapse:separate;
      border-spacing:0;
      overflow:auto;
      border:1px solid #eee;
      border-radius:12px;
    }
    .expenses-table th, .expenses-table td{
      border-bottom:1px solid #f0f0f0;
      padding:10px 8px;
      font-size:.95em;
      text-align:right;
      background:#fff;
    }
    .expenses-table thead th{
      position:sticky;
      top:0;
      z-index:1;
      background:#faf7f3;
      font-weight:700;
      color:#4e3826;
    }
    .expenses-table tr:last-child td{ border-bottom:none; }
    .expenses-table input, .expenses-table textarea{
      width:100%;
      border:1px solid #e6e6e6;
      border-radius:8px;
      padding:6px 8px;
      font-family:var(--body-font);
      box-sizing:border-box;
      background:#fff;
    }

    /* ورقة نتيجة اليوم */
    .day-slip{
      display:inline-flex;
      align-items:center;
      gap:10px;
      background:#fff7ea;
      color:#5b3c1e;
      border:1px dashed #e8d2b8;
      padding:8px 12px;
      border-radius:12px;
      font-size:.95em;
    }

    /* بطاقات الرسم/الكتابة الحرة */
    .cards-grid{
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(240px,1fr));
      gap:14px;
    }
    .draw-card{
      position:relative;
      border:1px solid #eee;
      border-radius:12px;
      overflow:hidden;
      background:#fff;
    }
    .draw-card .card-toolbar{
      position:absolute;
      top:8px; left:8px;
      z-index:2;
      display:flex; gap:6px;
      background:rgba(255,255,255,.85);
      border:1px solid #eee;
      border-radius:8px;
      padding:4px 6px;
      align-items:center;
      backdrop-filter:saturate(120%) blur(2px);
    }
    .draw-card .card-toolbar button,
    .draw-card .card-toolbar input[type="color"],
    .draw-card .card-toolbar input[type="range"]{
      border:1px solid #ddd;
      background:#fff;
      border-radius:6px;
      padding:4px 6px;
      cursor:pointer;
    }
    .draw-card .card-toolbar button:hover{ background:#fafafa; }
    .draw-card .ruled{
      height:260px;
    }
    .draw-card canvas{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      touch-action:none; /* لتحسين الرسم بالقلم */
    }

    /* جدول الحصص المصغر */
    .mini-timetable{
      display:grid;
      grid-template-columns:1fr;
      gap:10px;
      margin-bottom:12px;
    }
    .mini-timetable .meta{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .mini-timetable .meta input{
      width:100%;
      border:1px solid #ddd;
      border-radius:10px;
      padding:8px 10px;
      font-family:var(--body-font);
      background:#fff;
    }
    .periods{
      overflow:auto;
      border:1px solid #eee;
      border-radius:12px;
      background:#fff;
    }
    .periods table{
      width:100%;
      border-collapse:collapse;
    }
    .periods th, .periods td{
      border-bottom:1px solid #f3f3f3;
      padding:8px 10px;
      text-align:right;
      font-size:.95em;
    }
    .periods tr:last-child td{ border-bottom:none; }
    .periods input{
      width:100%;
      border:1px solid #e6e6e6;
      border-radius:8px;
      padding:6px 8px;
      font-family:var(--body-font);
    }

    /* التقويم المصغر في التذييل */
    .footer-calendars{
      margin-top:auto;
      border-top:1px solid var(--light-gray);
      padding-top:16px;
    }
    .months-grid{
      display:grid;
      grid-template-columns:repeat(3,1fr);
      gap:10px;
    }
    .mini-month{
      background:#fff;
      border:1px solid #eee;
      border-radius:12px;
      overflow:hidden;
      box-shadow:0 2px 6px rgba(0,0,0,.04);
    }
    .mini-month .mh{
      background:#f9f5f1;
      color:#4a3421;
      padding:8px 10px;
      font-weight:700;
      font-size:.95em;
      border-bottom:1px solid #efebe7;
    }
    .mini-month table{
      width:100%;
      border-collapse:collapse;
      table-layout:fixed;
    }
    .mini-month th, .mini-month td{
      text-align:center;
      font-size:.85em;
      padding:6px 0;
      border-bottom:1px solid #fafafa;
    }
    .mini-month tr:last-child td{ border-bottom:none; }
    .mini-month .wk th{
      background:#fdfdfd;
      color:#7a6a5a;
      font-weight:700;
    }
    .mini-month td.empty{ background:#fcfcfc; color:#c9c9c9; }

    /* استجابة */
    @media (max-width: 1200px){
      .planner-container{ flex-direction:column; gap:18px; }
      .spiral-wire{ height:56px; width:auto; min-width:unset; margin:8px 0; }
      .spiral-wire .strip{ height:56px; }
    }
    @media (max-width: 768px){
      .planner-page{ padding:20px; border-radius:16px; }
      .header .logo{ font-size:2.6em; }
      .tabs-section .tab-button{ padding:10px 14px; }
      .months-grid{ grid-template-columns:1fr 1fr; }
    }
  </style>
</head>
<body>

  <div class="planner-container">

    <!-- الصفحة اليمنى: شخصية -->
    <div class="planner-page personal-page">
      <div class="header">
        <div class="logo">MYH</div>
        <div class="title">
          <h1>صفحة الحياة اليومية الشخصية</h1>
          <p>أ/ محمد ياسين حلمي - مخطط 2026</p>
        </div>
      </div>

      <div class="tabs-section">
        <button class="tab-button" data-open="page-personal-tasks">
          <i class="fas fa-tasks"></i><span>مهام اليوم</span>
        </button>
        <button class="tab-button" data-open="page-expenses">
          <i class="fas fa-wallet"></i><span>المصروفات</span>
        </button>
        <button class="tab-button" data-open="page-personal-notes">
          <i class="fas fa-clipboard"></i><span>ملاحظات</span>
        </button>
      </div>

      <div class="placeholder-note">
        اضغط أي تبويب ليفتح صفحة كاملة مصمّمة للآيباد (كتابة بالقلم / إدخال نصي).
      </div>

      <!-- تقويم يناير–مارس 2026 -->
      <div class="footer-calendars">
        <div class="months-grid" id="right-months"></div>
      </div>
    </div>

    <!-- السبايرال -->
    <div class="spiral-wire">
      <div class="strip"></div>
      <svg preserveAspectRatio="none">
        <defs>
          <linearGradient id="metal" x1="0" y1="0" x2="1" y2="0">
            <stop offset="0%" stop-color="#c8c9cc"/>
            <stop offset="40%" stop-color="#f2f2f4"/>
            <stop offset="60%" stop-color="#9c9ca1"/>
            <stop offset="100%" stop-color="#e8e8ea"/>
          </linearGradient>
          <radialGradient id="ringShade" cx="50%" cy="50%" r="50%">
            <stop offset="0%" stop-color="#eaeaec"/>
            <stop offset="65%" stop-color="#a7a8ac"/>
            <stop offset="100%" stop-color="#6e6f73"/>
          </radialGradient>
          <pattern id="rings" width="56" height="34" patternUnits="userSpaceOnUse">
            <!-- عمود معدني رفيع في الوسط -->
            <rect x="26" y="0" width="4" height="34" fill="url(#metal)"/>
            <!-- الحلقة -->
            <ellipse cx="28" cy="17" rx="20" ry="10" fill="url(#ringShade)" opacity="0.95"/>
            <ellipse cx="28" cy="17" rx="18" ry="8" fill="#f7f7f9"/>
            <ellipse cx="28" cy="17" rx="16" ry="6" fill="url(#ringShade)" opacity="0.5"/>
          </pattern>
        </defs>
        <rect x="0" y="0" width="100%" height="100%" fill="url(#rings)"/>
      </svg>
    </div>

    <!-- الصفحة اليسرى: مهنية -->
    <div class="planner-page professional-page">
      <div class="header">
        <div class="logo">MYH</div>
        <div class="title">
          <h1>مركز المعلم الاحترافي</h1>
          <p>أ/ محمد ياسين حلمي - مخطط معلم الفنون 2026</p>
        </div>
      </div>

      <div class="tabs-section">
        <button class="tab-button" id="btn-daily-prep" data-open="page-daily-preparation">
          <i class="fas fa-palette"></i><span>التحضير اليومي</span>
        </button>
        <button class="tab-button" data-open="page-professional-tasks">
          <i class="fas fa-check-square"></i><span>المهام اليومية</span>
        </button>
        <button class="tab-button" data-open="page-creative-ideas">
          <i class="fas fa-lightbulb"></i><span>Creative Ideas</span>
        </button>
        <button class="tab-button" data-open="page-sunday">
          <i class="fas fa-calendar-day"></i><span>أحد الأسبوع</span>
        </button>
      </div>

      <div class="placeholder-note">
        ملاحظات: التحضير اليومي مفعّل فقط من الأحد إلى الخميس. تبويب أحد الأسبوع يوفر ١٠ بطاقات للكتابة بالقلم.
      </div>

      <!-- تقويم أبريل–يونيو 2026 -->
      <div class="footer-calendars">
        <div class="months-grid" id="left-months"></div>
      </div>
    </div>
  </div>

  <!-- صفحات كاملة (Overlays) -->

  <!-- يمين: مهام اليوم (Checkbox مسطر فارغ) -->
  <div class="page-overlay" id="page-personal-tasks">
    <div class="page">
      <div class="page-header">
        <button class="back-btn" data-close="#page-personal-tasks"><i class="fa fa-arrow-right"></i>رجوع</button>
        <h2 class="page-title">مهام اليوم - صفحة مسطّرة</h2>
      </div>
      <div class="page-card">
        <div class="toolbar">
          <button class="btn" data-add-line="#personalTasksList"><i class="fa fa-plus"></i>إضافة سطر</button>
          <button class="btn" data-clear-lines="#personalTasksList"><i class="fa fa-trash"></i>تفريغ القائمة</button>
        </div>
        <div class="ruled checkbox-ruled" id="personalTasksList"></div>
      </div>
    </div>
  </div>

  <!-- يمين: المصروفات -->
  <div class="page-overlay" id="page-expenses">
    <div class="page">
      <div class="page-header">
        <button class="back-btn" data-close="#page-expenses"><i class="fa fa-arrow-right"></i>رجوع</button>
        <h2 class="page-title">تتبع المصروفات</h2>
      </div>
      <div class="page-card">
        <div class="toolbar">
          <button class="btn" id="addExpenseRow"><i class="fa fa-plus"></i>إضافة صف</button>
          <button class="btn" id="clearExpenseRows"><i class="fa fa-trash"></i>مسح الكل</button>
        </div>
        <div style="overflow:auto;">
          <table class="expenses-table" id="expensesTable">
            <thead>
              <tr>
                <th>الرصيد</th>
                <th>viza</th>
                <th>walleti</th>
                <th>البند</th>
                <th>المصروف</th>
                <th>ملاحظات</th>
              </tr>
            </thead>
            <tbody>
              <!-- يضاف ديناميكياً -->
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>

  <!-- يمين: ملاحظات (مسطرة + ورقة نتيجة اليوم) -->
  <div class="page-overlay" id="page-personal-notes">
    <div class="page">
      <div class="page-header">
        <button class="back-btn" data-close="#page-personal-notes"><i class="fa fa-arrow-right"></i>رجوع</button>
        <h2 class="page-title">ملاحظات شخصية</h2>
      </div>
      <div class="page-card">
        <div class="day-slip" id="todaySlip"><i class="fa fa-calendar"></i><span>اليوم - التاريخ</span></div>
        <div class="ruled" style="margin-top:12px; min-height:70vh;"></div>
      </div>
    </div>
  </div>

  <!-- يسار: التحضير اليومي (أحد - خميس) -->
  <div class="page-overlay" id="page-daily-preparation">
    <div class="page">
      <div class="page-header">
        <button class="back-btn" data-close="#page-daily-preparation"><i class="fa fa-arrow-right"></i>رجوع</button>
        <h2 class="page-title">التحضير اليومي</h2>
      </div>
      <div class="page-card">
        <!-- جدول مصغر أعلى الصفحة -->
        <div class="mini-timetable">
          <div class="meta">
            <input id="className" type="text" placeholder="الصف (اكتب الصف هنا)">
            <input id="todayName" type="text" placeholder="اليوم الحالي" disabled>
          </div>
          <div class="periods">
            <table>
              <thead>
                <tr>
                  <th style="width:90px;">الحصة</th>
                  <th>الملاحظات / الهدف</th>
                </tr>
              </thead>
              <tbody id="periodsBody">
                <!-- 8 حصص -->
              </tbody>
            </table>
          </div>
        </div>

        <!-- 5 بطاقات مسطرة للرسم/الكتابة بالقلم -->
        <div class="cards-grid" id="prepCards">
          <!-- يُنشأ ديناميكياً 5 بطاقات -->
        </div>
      </div>
    </div>
  </div>

  <!-- يسار: المهام اليومية (Checkbox مسطر فارغ) -->
  <div class="page-overlay" id="page-professional-tasks">
    <div class="page">
      <div class="page-header">
        <button class="back-btn" data-close="#page-professional-tasks"><i class="fa fa-arrow-right"></i>رجوع</button>
        <h2 class="page-title">المهام اليومية المهنية</h2>
      </div>
      <div class="page-card">
        <div class="toolbar">
          <button class="btn" data-add-line="#professionalTasksList"><i class="fa fa-plus"></i>إضافة سطر</button>
          <button class="btn" data-clear-lines="#professionalTasksList"><i class="fa fa-trash"></i>تفريغ القائمة</button>
        </div>
        <div class="ruled checkbox-ruled" id="professionalTasksList"></div>
      </div>
    </div>
  </div>

  <!-- يسار: Creative Ideas (صفحة مسطرة تقليدية) -->
  <div class="page-overlay" id="page-creative-ideas">
    <div class="page">
      <div class="page-header">
        <button class="back-btn" data-close="#page-creative-ideas"><i class="fa fa-arrow-right"></i>رجوع</button>
        <h2 class="page-title">Creative Ideas - كتابة حرة</h2>
      </div>
      <div class="page-card">
        <div class="ruled" style="min-height:70vh;"></div>
      </div>
    </div>
  </div>

  <!-- يسار: أحد الأسبوع (10 بطاقات مسطرة) -->
  <div class="page-overlay" id="page-sunday">
    <div class="page">
      <div class="page-header">
        <button class="back-btn" data-close="#page-sunday"><i class="fa fa-arrow-right"></i>رجوع</button>
        <h2 class="page-title">أحد الأسبوع - بطاقات للكتابة بالقلم</h2>
      </div>
      <div class="page-card">
        <div class="cards-grid" id="sundayCards">
          <!-- يُنشأ ديناميكياً 10 بطاقات -->
        </div>
      </div>
    </div>
  </div>

  <script>
    // ========== أدوات مساعدة عامة ==========
    function openOverlay(id){
      document.getElementById(id)?.classList.add('active');
    }
    function closeOverlay(sel){
      const el = document.querySelector(sel);
      if(el) el.classList.remove('active');
    }
    function todayInfo(){
      const d = new Date();
      const locale = 'ar-EG'; // عربي
      const dayName = d.toLocaleDateString(locale,{ weekday:'long' });
      const dateStr = d.toLocaleDateString(locale,{ year:'numeric', month:'long', day:'numeric' });
      return { d, dayName, dateStr };
    }
    function isSunToThu(dateObj){
      // الأحد = 0 ... السبت = 6
      const n = dateObj.getDay();
      return (n>=0 && n<=4); // 0..4 => أحد-خميس
    }
    function isSunday(dateObj){
      return dateObj.getDay()===0;
    }

    // ========== إنشاء خطوط checkbox ==========
    function addCheckboxLine(container){
      const line = document.createElement('div');
      line.className='item';
      const cb = document.createElement('input');
      cb.type='checkbox';
      const span = document.createElement('div');
      span.className='line';
      line.appendChild(cb);
      line.appendChild(span);
      container.appendChild(line);
    }
    function fillCheckboxLines(container, count){
      for(let i=0;i<count;i++) addCheckboxLine(container);
    }
    function clearCheckboxLines(container){
      container.innerHTML='';
    }

    // ========== المصروفات ==========
    function addExpenseRow(){
      const tb = document.querySelector('#expensesTable tbody');
      const tr = document.createElement('tr');
      const cols = ['الرصيد','viza','walleti','البند','المصروف','ملاحظات'];
      for(let i=0;i<cols.length;i++){
        const td = document.createElement('td');
        if(i===5){
          const ta = document.createElement('textarea');
          ta.rows=1;
          td.appendChild(ta);
        }else{
          const inp = document.createElement('input');
          inp.type = (i===4) ? 'number' : 'text';
          td.appendChild(inp);
        }
        tr.appendChild(td);
      }
      tb.appendChild(tr);
    }
    function clearExpenseRows(){
      document.querySelector('#expensesTable tbody').innerHTML='';
    }

    // ========== بطاقات رسم (Canvas) ==========
    function setupDrawCard(cardEl){
      const ruled = document.createElement('div');
      ruled.className='ruled';
      cardEl.appendChild(ruled);

      const canvas = document.createElement('canvas');
      cardEl.appendChild(canvas);

      const toolbar = document.createElement('div');
      toolbar.className='card-toolbar';
      const clrBtn = document.createElement('button');
      clrBtn.innerHTML = '<i class="fa fa-eraser"></i>مسح';
      const colorInp = document.createElement('input'); colorInp.type='color'; colorInp.value='#333333';
      const rangeInp = document.createElement('input'); rangeInp.type='range'; rangeInp.min='1'; rangeInp.max='8'; rangeInp.value='2';
      toolbar.appendChild(colorInp);
      toolbar.appendChild(rangeInp);
      toolbar.appendChild(clrBtn);
      cardEl.appendChild(toolbar);

      const ctx = canvas.getContext('2d');
      let drawing=false, lastX=0, lastY=0, strokeStyle=colorInp.value, lineW=parseInt(rangeInp.value,10);

      function resize(){
        // احفظ الرسم مؤقتاً (اختياري: يمكن تجاهله لتبسيط)
        const prev = document.createElement('canvas');
        prev.width=canvas.width; prev.height=canvas.height;
        prev.getContext('2d').drawImage(canvas,0,0);
        const rect = cardEl.getBoundingClientRect();
        canvas.width = rect.width;
        canvas.height = rect.height;
        // أعد رسم المحتوى السابق إن وُجد
        ctx.drawImage(prev,0,0,prev.width,prev.height,0,0,canvas.width,canvas.height);
      }
      new ResizeObserver(resize).observe(cardEl); setTimeout(resize,50);

      function pos(e){
        const r = canvas.getBoundingClientRect();
        let x,y;
        if(e.touches && e.touches.length){
          x = e.touches[0].clientX - r.left;
          y = e.touches[0].clientY - r.top;
        }else{
          x = e.clientX - r.left;
          y = e.clientY - r.top;
        }
        return {x,y};
      }
      function start(e){
        e.preventDefault();
        drawing=true;
        const p = pos(e);
        lastX=p.x; lastY=p.y;
      }
      function move(e){
        if(!drawing) return;
        const p = pos(e);
        ctx.strokeStyle = strokeStyle;
        ctx.lineWidth = lineW;
        ctx.lineCap='round';
        ctx.lineJoin='round';
        ctx.beginPath();
        ctx.moveTo(lastX,lastY);
        ctx.lineTo(p.x,p.y);
        ctx.stroke();
        lastX=p.x; lastY=p.y;
      }
      function end(){ drawing=false; }

      canvas.addEventListener('pointerdown', start);
      canvas.addEventListener('pointermove', move);
      window.addEventListener('pointerup', end);
      canvas.addEventListener('touchstart', start, {passive:false});
      canvas.addEventListener('touchmove', move, {passive:false});
      window.addEventListener('touchend', end);

      clrBtn.addEventListener('click', ()=>{ ctx.clearRect(0,0,canvas.width,canvas.height); });
      colorInp.addEventListener('input', ()=>{ strokeStyle=colorInp.value; });
      rangeInp.addEventListener('input', ()=>{ lineW=parseInt(rangeInp.value,10); });
    }

    // ========== جدول الحصص 8 ==========
    function buildPeriods(){
      const tb = document.getElementById('periodsBody');
      tb.innerHTML='';
      for(let i=1;i<=8;i++){
        const tr=document.createElement('tr');
        const td1=document.createElement('td');
        td1.textContent='الحصة '+i;
        const td2=document.createElement('td');
        const inp=document.createElement('input');
        inp.type='text'; inp.placeholder='ملاحظات/هدف';
        td2.appendChild(inp);
        tr.appendChild(td1); tr.appendChild(td2);
        tb.appendChild(tr);
      }
    }

    // ========== التقويم المصغر ==========
    const monthsNames = ['يناير','فبراير','مارس','أبريل','مايو','يونيو','يوليو','أغسطس','سبتمبر','أكتوبر','نوفمبر','ديسمبر'];
    const weekNamesShort = ['أحد','اثن','ثلا','أرب','خمي','جمع','سبت']; // يبدأ الأحد
    function miniMonth(year, monthIdx){
      // احسب اليوم الأول وعدد الأيام
      const first = new Date(year, monthIdx, 1);
      const last = new Date(year, monthIdx+1, 0);
      const firstW = first.getDay(); // الأحد=0
      const days = last.getDate();
      // ابدأ بناء الجدول
      const wrapper = document.createElement('div'); wrapper.className='mini-month';
      const head = document.createElement('div'); head.className='mh';
      head.textContent = monthsNames[monthIdx]+' '+year;
      wrapper.appendChild(head);

      const table=document.createElement('table');
      const trh=document.createElement('tr'); trh.className='wk';
      weekNamesShort.forEach(w=>{
        const th=document.createElement('th'); th.textContent=w; trh.appendChild(th);
      });
      table.appendChild(trh);

      let tr=document.createElement('tr');
      // فراغات قبل أول يوم
      for(let i=0;i<firstW;i++){
        const td=document.createElement('td'); td.className='empty'; td.textContent=''; tr.appendChild(td);
      }
      let dow=firstW;
      for(let d=1; d<=days; d++){
        if(dow===7){ table.appendChild(tr); tr=document.createElement('tr'); dow=0; }
        const td=document.createElement('td'); td.textContent=d;
        tr.appendChild(td);
        dow++;
      }
      // أكمل الفراغات
      if(dow>0 && dow<7){
        for(let i=dow;i<7;i++){
          const td=document.createElement('td'); td.className='empty'; tr.appendChild(td);
        }
      }
      table.appendChild(tr);
      wrapper.appendChild(table);
      return wrapper;
    }
    function renderCalendars(){
      const right = document.getElementById('right-months');
      const left = document.getElementById('left-months');
      // يمين: يناير-مارس
      [0,1,2].forEach(m=> right.appendChild(miniMonth(2026,m)));
      // يسار: أبريل-يونيو
      [3,4,5].forEach(m=> left.appendChild(miniMonth(2026,m)));
    }

    // ========== تهيئة الصفحة ==========
    document.addEventListener('DOMContentLoaded', ()=>{
      // زر فتح/إغلاق الصفحات
      document.querySelectorAll('.tab-button[data-open]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const id = btn.getAttribute('data-open');
          openOverlay(id);
        });
      });
      document.querySelectorAll('.back-btn[data-close]').forEach(b=>{
        b.addEventListener('click', ()=> closeOverlay(b.getAttribute('data-close')));
      });

      // تفعيل/تعطيل "التحضير اليومي" حسب اليوم
      const info = todayInfo();
      const btnPrep = document.getElementById('btn-daily-prep');
      if(!isSunToThu(info.d)){
        btnPrep.classList.add('disabled');
        btnPrep.title='يتاح من الأحد إلى الخميس فقط';
      }

      // ورقة اليوم للملاحظات
      const todaySlip = document.getElementById('todaySlip');
      if(todaySlip){
        todaySlip.querySelector('span').textContent = info.dayName + ' - ' + info.dateStr;
      }

      // حقول اليوم/الصف في التحضير
      const todayName = document.getElementById('todayName');
      if(todayName) todayName.value = info.dayName + ' - ' + info.dateStr;

      // بناء جدول الحصص
      buildPeriods();

      // تهيئة قوائم checkbox
      const personalTasks = document.getElementById('personalTasksList');
      const professionalTasks = document.getElementById('professionalTasksList');
      fillCheckboxLines(personalTasks, 18);
      fillCheckboxLines(professionalTasks, 16);

      document.querySelectorAll('[data-add-line]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const sel = btn.getAttribute('data-add-line');
          const cont = document.querySelector(sel);
          addCheckboxLine(cont);
          cont.scrollTop = cont.scrollHeight;
        });
      });
      document.querySelectorAll('[data-clear-lines]').forEach(btn=>{
        btn.addEventListener('click', ()=>{
          const sel = btn.getAttribute('data-clear-lines');
          const cont = document.querySelector(sel);
          clearCheckboxLines(cont);
        });
      });

      // جدول المصروفات
      document.getElementById('addExpenseRow').addEventListener('click', addExpenseRow);
      document.getElementById('clearExpenseRows').addEventListener('click', clearExpenseRows);
      // صفين افتراضيين
      addExpenseRow(); addExpenseRow();

      // بطاقات التحضير (5)
      const prepCards = document.getElementById('prepCards');
      for(let i=0;i<5;i++){
        const c = document.createElement('div');
        c.className='draw-card';
        setupDrawCard(c);
        prepCards.appendChild(c);
      }

      // بطاقات الأحد (10)
      const sundayCards = document.getElementById('sundayCards');
      for(let i=0;i<10;i++){
        const c = document.createElement('div');
        c.className='draw-card';
        setupDrawCard(c);
        sundayCards.appendChild(c);
      }

      // إذا لم يكن اليوم أحد، اترك التبويب يعمل لكن يمكن عرض تلميح
      const sundayBtn = document.querySelector('[data-open="page-sunday"]');
      if(!isSunday(info.d)){
        sundayBtn.title = 'مخصص ليوم الأحد من كل أسبوع';
      }

      // التقويمات
      renderCalendars();

      // تحسين سحب بالإصبع داخل الصفحات
      document.querySelectorAll('.page-overlay').forEach(p=>{
        p.addEventListener('touchmove',()=>{}, {passive:true});
      });
    });
  </script>
</body>
</html>
