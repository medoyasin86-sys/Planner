<!doctype html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <title>MYH Master Planner 2026</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.10/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.10/vfs_fonts.js"></script>
    
    <style>
        :root { --royal: #192a56; --gold: #b8860b; }
        body { font-family: system-ui, -apple-system, sans-serif; background: #f0f2f5; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .card { background: white; padding: 40px; border-radius: 25px; box-shadow: 0 15px 35px rgba(0,0,0,0.2); text-align: center; border-top: 6px solid var(--gold); max-width: 500px; }
        h1 { color: var(--royal); font-size: 24px; }
        .btn { background: var(--royal); color: white; border: 1px solid var(--gold); padding: 15px 30px; border-radius: 10px; cursor: pointer; font-weight: bold; font-size: 16px; margin-top: 20px; transition: 0.3s; width: 100%; }
        .btn:hover { background: var(--gold); color: var(--royal); }
        .note { font-size: 12px; color: #666; margin-top: 15px; line-height: 1.6; }
        input[type="file"] { margin: 15px 0; font-size: 13px; }
    </style>
</head>
<body>

<div class="card">
    <h1>مخطط Mr. Mo. Yasin 2026</h1>
    <p>الإصدار التفاعلي (يناير - يوليو)</p>
    
    <div class="note">1. اختر ملف خط عربي (TTF) من جهازك أولاً:</div>
    <input type="file" id="fontFile" accept=".ttf" />
    
    <button class="btn" id="generateBtn">توليد وتحميل البلانر الآن ✨</button>
    
    <div class="note">
        * إذا ضغطت ولم يبدأ التحميل، تأكد من اختيار ملف الخط.<br>
        * البلانر مصمم ليعمل بامتياز على تطبيقات GoodNotes و Notability.
    </div>
    <p id="status" style="color: green; font-weight: bold; margin-top: 10px;"></p>
</div>

<script>
    let fontData = "";

    // تحويل الخط إلى Base64 عند اختياره
    document.getElementById('fontFile').addEventListener('change', function(e) {
        const reader = new FileReader();
        reader.onload = function() {
            fontData = reader.result.split(',')[1];
            document.getElementById('status').innerText = "✅ الخط جاهز، اضغط للتوليد";
        };
        reader.readAsDataURL(e.target.files[0]);
    });

    document.getElementById('generateBtn').onclick = function() {
        if (!fontData) {
            alert("من فضلك اختر ملف خط (TTF) لضمان ظهور اللغة العربية بشكل صحيح.");
            return;
        }

        document.getElementById('status').innerText = "⏳ جاري التوليد... يرجى الانتظار ثوانٍ";

        // إعدادات الخطوط في pdfmake
        pdfMake.vfs = { 'MyFont.ttf': fontData };
        pdfMake.fonts = {
            MyFont: {
                normal: 'MyFont.ttf',
                bold: 'MyFont.ttf',
                italics: 'MyFont.ttf'
            }
        };

        const months = ["يناير", "فبراير", "مارس", "أبريل", "مايو", "يونيو", "يوليو"];
        let content = [];

        // 1. الغلاف
        content.push({
            stack: [
                { text: '2026', fontSize: 60, color: '#b8860b', bold: true, margin: [0, 150, 0, 10] },
                { text: 'البلانر الرقمي الملكي', fontSize: 25, color: 'white' },
                { text: 'Mr. Mo. Yasin', fontSize: 30, color: '#b8860b', margin: [0, 50], font: 'MyFont' }
            ],
            fillColor: '#192a56', alignment: 'center', pageBreak: 'after'
        });

        // 2. الفهرس
        content.push({
            id: 'index_page',
            stack: [
                { text: 'الفهرس التفاعلي', fontSize: 30, color: '#192a56', margin: [0, 0, 0, 20] },
                {
                    table: {
                        widths: ['*'],
                        body: months.map(m => [{ text: m, linkToDestination: 'month_' + m, margin: [0, 10], fontSize: 18, color: 'blue' }])
                    },
                    layout: 'noBorders'
                }
            ],
            alignment: 'center', pageBreak: 'after'
        });

        // 3. توليد الصفحات اليومية (بدون ترقيم حصص)
        const startDate = new Date(2026, 0, 1);
        const endDate = new Date(2026, 6, 31);

        for (let d = new Date(startDate); d <= endDate; d.setDate(d.getDate() + 1)) {
            const currentMonthName = months[d.getMonth()];
            const dateStr = d.toLocaleDateString('ar-EG', { day: 'numeric', month: 'long' });
            
            // وسم بداية كل شهر للربط التفاعلي
            let pageId = d.getDate() === 1 ? { id: 'month_' + currentMonthName } : {};

            content.push({
                ...pageId,
                padding: [30, 20, 30, 20],
                stack: [
                    {
                        columns: [
                            { text: 'Mr. Mo. Yasin', fontSize: 20, color: '#b8860b', width: '*' }, // توقيع انسيابي
                            { text: dateStr, fontSize: 16, color: '#192a56', bold: true, alignment: 'left' }
                        ]
                    },
                    { canvas: [{ type: 'line', x1: 0, y1: 5, x2: 515, y2: 5, lineWidth: 1, lineColor: '#b8860b' }] },
                    {
                        margin: [0, 20, 0, 0],
                        columns: [
                            {
                                width: '35%',
                                stack: [
                                    { text: 'جدول الحصص', color: '#192a56', bold: true, margin: [0, 0, 0, 10] },
                                    {
                                        table: {
                                            widths: ['*'],
                                            body: [
                                                ['07:35 - 08:15'], ['08:20 - 09:00'], ['09:05 - 09:45'], ['09:50 - 10:30'],
                                                [{ text: 'الفسحة', fillColor: '#eee' }],
                                                ['10:55 - 11:35'], ['11:40 - 12:20'], ['12:25 - 01:05'], ['01:10 - 01:50']
                                            ]
                                        }
                                    },
                                    { text: 'العودة للفهرس', linkToDestination: 'index_page', color: 'blue', fontSize: 10, margin: [0, 20] }
                                ]
                            },
                            {
                                width: '60%',
                                margin: [15, 0, 0, 0],
                                stack: [
                                    { text: 'التحضير والمهام (البطاقات الـ 5)', color: '#192a56', bold: true },
                                    ...Array(5).fill(0).map(() => ({
                                        margin: [0, 5, 0, 5],
                                        canvas: [{ type: 'rect', x: 0, y: 0, w: 300, h: 60, r: 5, lineColor: '#ccc' }]
                                    }))
                                ]
                            }
                        ]
                    }
                ],
                pageBreak: 'after'
            });
        }

        const docDefinition = {
            pageSize: 'A4',
            defaultStyle: { font: 'MyFont', alignment: 'right' },
            content: content
        };

        pdfMake.createPdf(docDefinition).download('MYH_Planner_2026_Jan_July.pdf');
        document.getElementById('status').innerText = "✅ تم التحميل بنجاح!";
    };
</script>

</body>
</html>
