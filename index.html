<!doctype html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="utf-8" />
    <title>MYH Luxury Double-Page Planner 2026</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.10/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.2.10/vfs_fonts.js"></script>
    <style>
        :root { --royal: #192a56; --gold: #b8860b; --silk: #fdfdfd; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #eceff1; display: flex; justify-content: center; align-items: center; height: 100vh; margin: 0; }
        .setup-box { background: white; padding: 40px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); text-align: center; border-top: 5px solid var(--gold); }
        .btn-gold { background: var(--gold); color: white; border: none; padding: 15px 40px; border-radius: 30px; cursor: pointer; font-weight: bold; font-size: 18px; margin-top: 20px; transition: 0.3s; }
        .btn-gold:hover { background: var(--royal); transform: translateY(-2px); }
        input[type="file"] { margin: 20px 0; }
    </style>
</head>
<body>

<div class="setup-box">
    <h1 style="color: var(--royal);">MYH Master Planner 2026</h1>
    <p>نظام الصفحتين المتقابلتين - نسخة آيباد 10.2 الفاخرة</p>
    <div style="font-size: 13px; color: #666; margin-bottom: 10px;">يرجى رفع خط (Tajawal أو Adobe Arabic) بصيغة TTF لضمان الفخامة:</div>
    <input type="file" id="fontFile" accept=".ttf" />
    <br>
    <button class="btn-gold" id="genBtn">توليد البلانر الاحترافي PDF</button>
    <p id="msg" style="margin-top: 15px; color: #b8860b; font-weight: bold;"></p>
</div>

<script>
    let fontB64 = "";
    document.getElementById('fontFile').onchange = (e) => {
        const reader = new FileReader();
        reader.onload = () => { fontB64 = reader.result.split(',')[1]; document.getElementById('msg').innerText = "✅ الخط جاهز للتنفيذ"; };
        reader.readAsDataURL(e.target.files[0]);
    };

    const COLORS = { royal: "#192a56", gold: "#b8860b", silk: "#f9f9f9", line: "#e0e0e0" };

    // دالة توليد أوقات الحصص بدقة
    function getSchedule() {
        let times = [];
        let start = new Date(); start.setHours(7, 35, 0);
        for(let i=1; i<=8; i++) {
            let end = new Date(start.getTime() + 40 * 60000);
            times.push(`${start.getHours()}:${start.getMinutes().toString().padStart(2,'0')} - ${end.getHours()}:${end.getMinutes().toString().padStart(2,'0')}`);
            if(i === 4) start = new Date(end.getTime() + 25 * 60000); // فسحة 25 دقيقة
            else start = new Date(end.getTime() + 5 * 60000); // فاصل 5 دقائق
        }
        return times;
    }

    document.getElementById('genBtn').onclick = () => {
        if(!fontB64) return alert("يرجى اختيار ملف الخط أولاً");
        document.getElementById('msg').innerText = "⏳ جاري بناء الصفحات المتقابلتين...";

        pdfMake.vfs = { 'F.ttf': fontB64 };
        pdfMake.fonts = { MyFont: { normal: 'F.ttf', bold: 'F.ttf', italics: 'F.ttf' } };

        const schedule = getSchedule();
        let docContent = [];

        // 1. الغلاف الفاخر
        docContent.push({
            stack: [
                { text: '2026', fontSize: 80, color: COLORS.gold, bold: true, margin: [0, 150, 0, 10] },
                { text: 'THE MASTER DIGITAL PLANNER', fontSize: 20, color: 'white', letterSpacing: 5 },
                { text: 'Mr. Mo. Yasin', fontSize: 35, color: COLORS.gold, margin: [0, 50], font: 'MyFont' }
            ],
            fillColor: COLORS.royal, alignment: 'center', pageBreak: 'after'
        });

        // 2. الفهرس والتقويم السنوي (يناير - يوليو)
        docContent.push({
            id: 'index',
            stack: [
                { text: 'الفهرس التفاعلي والتقويم السنوي', fontSize: 24, color: COLORS.royal, margin: [0, 20] },
                {
                    table: {
                        widths: ['*', '*', '*'],
                        body: [
                            [{text: 'يناير', linkToDestination: 'm-0', color: 'blue'}, {text: 'فبراير', linkToDestination: 'm-1', color: 'blue'}, {text: 'مارس', linkToDestination: 'm-2', color: 'blue'}],
                            [{text: 'أبريل', linkToDestination: 'm-3', color: 'blue'}, {text: 'مايو', linkToDestination: 'm-4', color: 'blue'}, {text: 'يونيو', linkToDestination: 'm-5', color: 'blue'}]
                        ]
                    }, alignment: 'center'
                }
            ], pageBreak: 'after'
        });

        // 3. حلقة توليد الأيام (صفحتين لكل يوم)
        let start = new Date(2026, 0, 1);
        let end = new Date(2026, 6, 31);

        for (let d = new Date(start); d <= end; d.setDate(d.getDate() + 1)) {
            let dayName = d.toLocaleDateString('ar-OM', { weekday: 'long' });
            let dateStr = d.toLocaleDateString('ar-OM', { day: 'numeric', month: 'long' });
            let pageId = d.getDate() === 1 ? { id: 'm-' + d.getMonth() } : {};

            // --- صفحة اليمين: العمل ---
            docContent.push({
                ...pageId,
                padding: [20, 20, 20, 20],
                stack: [
                    { columns: [ {text: 'Mr. Mo. Yasin', style: 'sig'}, {text: `صفحة العمل | ${dayName} ${dateStr}`, style: 'h1'} ] },
                    { canvas: [{ type: 'line', x1: 0, y1: 5, x2: 500, y2: 5, lineWidth: 1, lineColor: COLORS.gold }] },
                    {
                        margin: [0, 15, 0, 0],
                        columns: [
                            { // عمود الجدول
                                width: '40%',
                                stack: [
                                    { text: 'جدول الحصص الذكي', style: 'h2' },
                                    {
                                        table: {
                                            widths: ['*'],
                                            body: schedule.map(t => [{text: t, fontSize: 10, margin: [0, 5]}])
                                        }, layout: 'lightHorizontalLines'
                                    },
                                    { text: 'قائمة المهام العاجلة', style: 'h2', margin: [0, 15, 0, 5] },
                                    { table: { widths: [10, '*'], body: Array(6).fill([{text:''}, {text:'', margin:[0,5]}]) } }
                                ]
                            },
                            { // عمود البطاقات الـ 5
                                width: '60%', margin: [15, 0, 0, 0],
                                stack: [
                                    { text: 'بطاقات العمل والتحضير', style: 'h2' },
                                    ...Array(5).fill(0).map(() => ({
                                        margin: [0, 2, 0, 5],
                                        canvas: [{ type: 'rect', x: 0, y: 0, w: 280, h: 75, r: 5, lineColor: COLORS.line }]
                                    }))
                                ]
                            }
                        ]
                    }
                ], pageBreak: 'after'
            });

            // --- صفحة اليسار: الحياة والحسابات ---
            docContent.push({
                padding: [20, 20, 20, 20],
                stack: [
                    { columns: [ {text: 'الحياة اليومية والحسابات', style: 'h1', alignment: 'right'}, {text: 'العودة للفهرس', linkToDestination: 'index', fontSize: 10, color: 'blue'} ] },
                    {
                        margin: [0, 20, 0, 0],
                        columns: [
                            { // الحياة اليومية
                                width: '50%',
                                stack: [
                                    { text: 'عمود المهام الشخصية', style: 'h2' },
                                    { table: { widths: [15, '*'], body: Array(10).fill([{text:''}, {text:'', margin:[0,8]}]) } },
                                    { text: 'ملاحظات اليوم', style: 'h2', margin:[0,15] },
                                    { canvas: [{ type: 'rect', x: 0, y: 0, w: 230, h: 150, r: 10, lineColor: COLORS.line }] }
                                ]
                            },
                            { // الحسابات
                                width: '50%', margin: [10, 0, 0, 0],
                                stack: [
                                    { text: 'الحسابات اليومية (مساحة حرة)', style: 'h2' },
                                    { canvas: [{ type: 'rect', x: 0, y: 0, w: 230, h: 250, r: 5, lineColor: COLORS.gold, dash: {length: 2} }] },
                                    { text: 'ملخص الحسابات الأسبوعي', style: 'h2', margin: [0, 20, 0, 5] },
                                    {
                                        table: {
                                            widths: ['*', 'auto', 'auto'],
                                            body: [['البند', 'دخل', 'صرف'], ['', '', ''], ['', '', ''], [{text: 'الصافي', bold:true}, {colSpan: 2, text: ''}]]
                                        }
                                    }
                                ]
                            }
                        ]
                    }
                ], pageBreak: 'after'
            });
        }

        const docDefinition = {
            pageSize: { width: 842, height: 595 }, // Landscape mode for iPad double-page feel
            defaultStyle: { font: 'MyFont', alignment: 'right' },
            styles: {
                h1: { fontSize: 18, bold: true, color: COLORS.royal },
                h2: { fontSize: 12, bold: true, color: COLORS.gold, margin: [0, 5] },
                sig: { fontSize: 20, italics: true, color: COLORS.gold, alignment: 'left' }
            },
            content: docContent
        };

        pdfMake.createPdf(docDefinition).download('MYH_Luxury_2026_Planner.pdf');
        document.getElementById('msg').innerText = "✅ اكتمل التحميل! البلانر جاهز لـ GoodNotes";
    };
</script>

</body>
</html>
